import { __InterfaceFragment } from '@codelab/codegen/graphql'
import { FormUniforms, FormUniformsProps } from '@codelab/frontend/shared'
import React, { useEffect, useState } from 'react'
import { interfaceToJsonSchema } from './transformations'

export interface InterfaceFormProps<TData>
  extends Omit<FormUniformsProps<TData>, 'schema'> {
  interface: __InterfaceFragment
}

/**
 * Uniforms form generated by an Interface
 */
export const InterfaceForm = <TData extends any>({
  interface: intface,
  children,
  ...props
}: React.PropsWithChildren<InterfaceFormProps<TData>>) => {
  const [generatedSchema, setGeneratedSchema] = useState(
    interfaceToJsonSchema(intface) as TData,
  )

  useEffect(() => {
    setGeneratedSchema(interfaceToJsonSchema(intface) as TData)
  }, [intface])

  return (
    <FormUniforms schema={generatedSchema as any} {...props}>
      {children}
    </FormUniforms>
  )
}

InterfaceForm.displayName = 'InterfaceForm'
